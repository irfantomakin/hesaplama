<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link rel="apple-touch-icon" href="image/icon2.png">
<link rel="icon" type="image/png" href="image/icon2.png">

<meta name="apple-mobile-web-app-title" content="SÃ¼re">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ðŸ•’ SÃ¼re Hesaplama</title>

<style>
  :root{
    --bg:#f6f7f9;
    --card:#fff;
    --border:#e6e6e6;
    --shadow:0 6px 16px rgba(0,0,0,.06);
    --danger:#c62828;
    --dark:#2b2b2b;
    --safeTop: env(safe-area-inset-top, 0px);
    --safeBottom: env(safe-area-inset-bottom, 0px);
  }
  html,body{height:100%}
  body{
    margin:0;
    padding:12px 12px calc(12px + var(--safeBottom));
    background:var(--bg);
    font-family: Arial, sans-serif;
    max-width:1100px;
    margin-inline:auto;
  }

  /* Mobil sekmeler */
  .toolbar{
    display:flex;
    gap:10px;
    justify-content:center;
    margin: calc(6px + var(--safeTop)) 0 10px;
  }
  .btn{
    padding:10px 16px;
    border-radius:14px;
    border:1px solid #ddd;
    background:#fff;
    font-weight:800;
    cursor:pointer;
    min-width:170px;
  }
  .btn.active{border-color:#111}

  .areas{display:flex; gap:16px; align-items:flex-start;}
  .area{
    flex:1;
    background:var(--card);
    border:1px solid var(--border);
    border-radius:18px;
    padding:14px;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    min-height:0;
  }
  .area-head{
    position: sticky;
    top: 0;
    background: var(--card);
    z-index: 5;
    padding-bottom: 10px;
  }

  .titlebar{
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:10px;
  }
  .spacer{flex:1}
  .total-mini{
    display:flex;
    align-items:baseline;
    gap:10px;
    padding:10px 12px;
    border:1px solid #eee;
    border-radius:14px;
    background:#fff;
  }
  .tlabel{font-weight:900; font-size:18px;}
  .tvalue{font-weight:900; font-size:45px;}
  .clear-all{
    border: 1px solid #f1b7b7;
    background: #fff;
    color: var(--danger);
    font-weight: 900;
    border-radius: 14px;
    padding: 10px 14px;
    cursor: pointer;
    white-space: nowrap;
  }

  .above-diff{
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:10px;
  }
  .time-icon{
    width:32px;
    min-width:32px;
    text-align:center;
    font-size:22px;
    line-height:1;
    opacity:.85;
  }
  .time-input{
    width:150px;
    padding:12px;
    text-align:center;
    font-size:20px;
    border-radius:16px;
    border:2px solid #dcdcdc;
    outline:none;
    background:#fff;
    color:#111;
    box-sizing:border-box;
    font-variant-numeric: tabular-nums;
  }
  .time-input:focus{
    outline: 4px solid var(--danger);
    outline-offset: 0px;
    box-shadow: 0 0 0 4px rgba(198,40,40,.12);
  }
  .time-input.filled{
    background:var(--dark);
    color:#fff;
    border-color:var(--dark);
  }

  .icon-btn{
    width:42px;
    height:42px;
    border-radius:16px;
    border:1px solid #ddd;
    background:#fff;
    font-size:22px;
    font-weight:900;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    flex:0 0 auto;
  }

  .diff-row{
    display:flex;
    align-items:baseline;
    gap:12px;
    flex-wrap:wrap;
  }

  .top-diff{
    font-size:54px;
    font-weight:900;
    color:var(--danger);
    min-height:60px;
    display:flex;
    align-items:center;
    font-variant-numeric: tabular-nums;
  }

  .comment-pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 12px;
    border:1px solid #eee;
    border-radius:14px;
    background:#fff;
    font-weight:900;
    font-size:18px;
    line-height:1;
    white-space:nowrap;
    font-variant-numeric: tabular-nums;
  }
  .comment-pill .tag{opacity:.7;font-weight:900;}

  .manual-row{
    display:flex;
    align-items:center;
    gap:10px;
    margin-top:10px;
    flex-wrap:wrap;
  }
  .manual-input{
    width:140px;
    padding:10px 12px;
    text-align:center;
    font-size:18px;
    border-radius:14px;
    border:2px solid #dcdcdc;
    outline:none;
    background:#fff;
    font-weight:900;
    font-variant-numeric: tabular-nums;
  }
  .manual-input:focus{
    outline: 4px solid rgba(0,0,0,.08);
    outline-offset: 0px;
  }

  .list{
    border-top:1px dashed #eee;
    border-bottom:1px dashed #eee;
    padding:6px 0 18px;
    min-height:0;
    overflow:auto;
    -webkit-overflow-scrolling:touch;
  }
  .row{
    display:flex;
    align-items:center;
    gap:10px;
    padding:8px 0;
    border-bottom:1px dashed #eee;
  }
  .row:last-child{border-bottom:none}
  .idx{
    width:34px;
    text-align:right;
    font-weight:800;
    color:#666;
    flex:0 0 auto;
  }

  @media (min-width: 901px){
    .toolbar{ display:none; }
  }

  @media (max-width:900px){
    html,body{ height:100dvh; overflow:hidden; }
    .areas{ display:block; }
    .area{
      display:none;
      height: calc(100dvh - (86px + var(--safeTop) + var(--safeBottom)));
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    .area.active{ display:flex; }
    .top-diff{ font-size:46px; }
    .time-input{ width:140px; font-size:20px; }
    .icon-btn{ width:50px; height:50px; }
    .comment-pill{ font-size:16px; padding:8px 10px; }
    .manual-input{ width:150px; font-size:16px; }
  }

  .status-ok{ color:#1b5e20; }
  .status-bad{ color: var(--danger); }


  /* --- GÃ¶rsel ayrÄ±m: Etiket Ã¼stte, sayÄ± altta --- */
  .total-mini{
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
  }
  .tlabel{
    font-size: 10px;
    opacity: .75;
  }
  .tvalue{
    font-size: 25px;
    line-height: 1;
  }

  .comment-pill{
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    padding: 10px 14px;
  }
  .comment-pill .tag{
    font-size: 13px;
    letter-spacing: .3px;
    text-transform: none;
    opacity: .65;
  }
  /* comment-pill iÃ§indeki deÄŸerleri bÃ¼yÃ¼t */
  #commentVal1, #commentVal2{
    font-size: 22px;
    font-weight: 900;
    line-height: 1;
  }
  #manualVal1, #manualVal2{
    font-size: 24px;
    font-weight: 900;
    line-height: 1;
  }

  /* Manuel saat kutusunu da biraz bÃ¼yÃ¼t */
  .manual-input{
    font-size: 20px;
    padding: 12px 14px;
    border-radius: 16px;
  }

  /* Mobilde aÅŸÄ±rÄ± taÅŸmayÄ± Ã¶nle */
  @media (max-width:900px){
    .tvalue{ font-size: 25px; }
    #commentVal1, #commentVal2{ font-size: 20px; }
    #manualVal1, #manualVal2{ font-size: 22px; }
  }


/* === YENÄ° GÃ–RSEL DÃœZEN === */

/* Saat ikonlu satÄ±r: kÄ±rmÄ±zÄ± bÃ¼yÃ¼k sayÄ± yanÄ±na */
.above-diff{
  align-items: center;
  gap: 14px;
}

/* KÄ±rmÄ±zÄ± ana fark (remain) ikonlu satÄ±ra yaklaÅŸtÄ±r */
.top-diff{
  font-size: 48px;
  margin-left: 8px;
}

/* Haberlerle + saat biraz daha bÃ¼yÃ¼k */
#commentVal1, #commentVal2{
  font-size: 26px;
}

/* YORUM alanÄ± en bÃ¼yÃ¼k */
#manualVal1, #manualVal2{
  font-size: 45px;
}

/* YORUM kapsayÄ±cÄ±yÄ± Ã¶ne Ã§Ä±kar */
.comment-pill{
  background: #f7f9fc;
  border-width: 2px;
}


/* === DÃœZELTME: KIRMIZI ALANI YUKARI AL + YORUM Ã‡ERÃ‡EVE RENKLERÄ° === */

/* above-diff iÃ§inde kÄ±rmÄ±zÄ± fark da hizalansÄ±n */
.above-diff{
  display:flex;
  align-items:center;
  gap:14px;
}

/* kÄ±rmÄ±zÄ± bÃ¼yÃ¼k sayÄ± Ã¼st satÄ±ra taÅŸÄ±nmÄ±ÅŸ gibi */
.above-diff .top-diff{
  order: 3;
  font-size: 30px;
  margin-left: 8px;
}

/* YORUM kapsayÄ±cÄ± varsayÄ±lan (yeÅŸil) */
.comment-pill{
  border: 2px solid #1b5e20;
  background:#f7f9fc;
}

/* YORUM yeÅŸil durum */
.status-ok{
  color:#1b5e20;
}
.status-ok.comment-pill,
.comment-pill .status-ok{
  border-color:#1b5e20;
}

/* YORUM kÄ±rmÄ±zÄ± durum (sÃ¼re geÃ§ti) */
.status-bad{
  color: var(--danger);
}
.status-bad.comment-pill,
.comment-pill .status-bad{
  border-color: var(--danger);
}


  .comment-pill.status-ok{ border-color:#1b5e20; }
  .comment-pill.status-bad{ border-color: var(--danger); }


/* === HÄ°ZALAMA DÃœZELTMESÄ° (eÅŸit ve dengeli gÃ¶rÃ¼nÃ¼m) === */
.area-head{
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* Ãœst satÄ±r: ikon + girilen + sil + kÄ±rmÄ±zÄ± sÃ¼re aynÄ± hizaya */
.above-diff{
  display:grid;
  grid-template-columns: 32px 150px 52px 1fr;
  align-items:center;
  gap:12px;
}

/* KÄ±rmÄ±zÄ± bÃ¼yÃ¼k sÃ¼re (remain) sabit hizalÄ± */
.top-diff{
  justify-self:start;
  min-width:120px;
  line-height:1;
}

/* Haberlerle + Yorum kutularÄ± dengeli */
.diff-row{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
  align-items:stretch;
}

/* Kart geniÅŸlikleri eÅŸitlensin */
.comment-pill{
  width:100%;
  box-sizing:border-box;
}

/* Manuel saat alanÄ±: taÅŸma olmasÄ±n */
.manual-input{
  width:100%;
  max-width:180px;
  box-sizing:border-box;
}

/* Mobilde grid geniÅŸliklerini esnet */
@media (max-width:900px){
  .above-diff{
    grid-template-columns: 32px 1fr 50px;
    grid-template-areas:
      "icon input clear"
      "remain remain remain";
    row-gap:10px;
  }
  .above-diff .time-icon{ grid-area: icon; }
  .above-diff #sub1, .above-diff #sub2{ grid-area: input; }
  .above-diff #clearSub1, .above-diff #clearSub2{ grid-area: clear; }
  .above-diff .top-diff{
    grid-area: remain;
    margin-left:0;
  }

  .diff-row{
    grid-template-columns: 1fr;
  }
  .manual-input{ max-width: 100%; }
}


/* === MOBÄ°L DÃœZELTME: Saat ikonunu kaldÄ±r === */
.time-icon{
  display:none !important;
}

/* Ä°kon kalkÄ±nca grid'i sÄ±kÄ±ÅŸtÄ±r */
.above-diff{
  grid-template-columns: 1fr 52px 1fr;
}

/* Mobilde kÄ±rmÄ±zÄ± alan yukarÄ± sÄ±ÄŸsÄ±n */
@media (max-width:900px){
  .above-diff{
    grid-template-columns: 1fr 52px;
    grid-template-areas:
      "input clear"
      "remain remain";
  }
}


/* === MOBÄ°L: KÄ±rmÄ±zÄ± sÃ¼re aÅŸaÄŸÄ± dÃ¼ÅŸmesin (aynÄ± satÄ±r) === */
@media (max-width:900px){
  .above-diff{
    display:grid;
    grid-template-columns: 1fr auto 52px;
    grid-template-areas: "input remain clear";
    align-items:center;
    column-gap:10px;
    row-gap:0;
  }
  /* ikon gizli olduÄŸu iÃ§in alan atamalarÄ± */
  .above-diff #sub1, .above-diff #sub2{ grid-area: input; }
  .above-diff .top-diff{ 
    grid-area: remain; 
    white-space: nowrap;
    min-width: 0;
    font-size: 40px; /* biraz kÃ¼Ã§Ã¼lterek satÄ±ra sÄ±ÄŸdÄ±r */
    margin: 0;
  }
  .above-diff #clearSub1, .above-diff #clearSub2{ grid-area: clear; }

  /* girilen kutusu Ã§ok uzamasÄ±n */
  .above-diff input{
    width: 100%;
    max-width: 180px;
  }
}

</style>
</head>

<body>

<div class="toolbar">
  <button class="btn active" id="tab1" type="button">Reklamdan Ã–nce</button>
  <button class="btn" id="tab2" type="button">Reklamdan Sonra</button>
</div>

<div class="areas">

  <!-- ALAN 1 -->
  <div class="area active" data-area="1">
    <div class="area-head">
      <div class="titlebar">
        <div class="total-mini">
		
          <span class="tlabel">HABER TOPLAM:</span>
          <span class="tvalue" id="total1">â€”:â€”</span>
        </div>
		        <div class="comment-pill">
          <span class="tag">HABER + SAAT</span>
          <span id="commentVal1">â€”:â€”</span>
		  
        </div>
       
        <button class="clear-all" id="clearArea1" type="button">Hepsini Sil</button>
      </div>

      <div class="above-diff">
        <div class="time-icon" aria-hidden="true">ðŸ•’</div>
        <input id="sub1" class="time-input" placeholder="MM:SS" inputmode="numeric" pattern="[0-9]*" autocomplete="off" spellcheck="false">
        <button class="icon-btn" id="clearSub1" type="button" aria-label="Girilen temizle" title="Girilen temizle">âœ•</button>
		<div class="top-diff" id="remain1">â€”:â€”</div>
      </div>

      <div class="diff-row">
        


		<input id="manual1" class="manual-input" placeholder="HH:MM:SS" inputmode="numeric" autocomplete="off" spellcheck="false">
		        <div class="comment-pill">
          <span class="tag">YORUM</span>
          <span id="manualVal1">â€”:â€”</span>
        </div>
      </div>

      <div class="manual-row">

      </div>
    </div>

    <div class="list" id="area1"></div>
  </div>

  <!-- ALAN 2 -->
  <div class="area" data-area="2">
    <div class="area-head">
      <div class="titlebar">
        <div class="total-mini">
          <span class="tlabel">HABER TOPLAM:</span>
          <span class="tvalue" id="total2">â€”:â€”</span>
        </div>
		        <div class="comment-pill">
          <span class="tag">HABER + SAAT</span>
          <span id="commentVal2">â€”:â€”</span>
        </div>
 
        <button class="clear-all" id="clearArea2" type="button">Hepsini Sil</button>
      </div>

      <div class="above-diff">
        <div class="time-icon" aria-hidden="true">ðŸ•’</div>
        <input id="sub2" class="time-input" placeholder="DK:SN" inputmode="numeric" pattern="[0-9]*" autocomplete="off" spellcheck="false">
        <button class="icon-btn" id="clearSub2" type="button" aria-label="Girilen temizle" title="Girilen temizle">âœ•</button>
		<div class="top-diff" id="remain2">â€”:â€”</div>
      </div>

      <div class="diff-row">
        


		<input id="manual2" class="manual-input" placeholder="HH:MM:SS" inputmode="numeric" autocomplete="off" spellcheck="false">
      <div class="comment-pill">
          <span class="tag">YORUM</span>
          <span id="manualVal2">â€”:â€”</span>
        </div>
      </div>
  
      <div class="manual-row">

      </div>
    </div>

    <div class="list" id="area2"></div>
  </div>

</div>

<script>
  
  // âœ… iOS Safari'de ID'ler otomatik global deÄŸiÅŸken olmaz. Hepsini elle baÄŸlayalÄ±m.
  const tab1 = document.getElementById("tab1");
  const tab2 = document.getElementById("tab2");

  const total1 = document.getElementById("total1");
  const total2 = document.getElementById("total2");

  const sub1 = document.getElementById("sub1");
  const sub2 = document.getElementById("sub2");

  const clearSub1 = document.getElementById("clearSub1");
  const clearSub2 = document.getElementById("clearSub2");

  const clearArea1 = document.getElementById("clearArea1");
  const clearArea2 = document.getElementById("clearArea2");

  const remain1 = document.getElementById("remain1");
  const remain2 = document.getElementById("remain2");

  const commentVal1 = document.getElementById("commentVal1");
  const commentVal2 = document.getElementById("commentVal2");

  const manual1 = document.getElementById("manual1");
  const manual2 = document.getElementById("manual2");

  const manualVal1 = document.getElementById("manualVal1");
  const manualVal2 = document.getElementById("manualVal2");

const allInputs = [];

  // ----------------- MM:SS helpers -----------------
  function sanitizeMMSS(value){
    value = (value || "").replace(/[^0-9:]/g,"");
    const parts = value.split(":");
    if(parts.length > 2){
      value = parts[0] + ":" + parts.slice(1).join("").replace(/:/g,"");
    }
    return value;
  }

  function autoFormatMMSS(v){
    v = sanitizeMMSS(v);
    if(!v) return "";

    if(v.includes(":")){
      let [m,s] = v.split(":");
      m = parseInt(m || "0",10) || 0;
      s = parseInt(s || "0",10) || 0;
      m += Math.floor(s/60);
      s = s % 60;
      return `${m}:${String(s).padStart(2,"0")}`;
    }

    const d = v.replace(/\D/g,"");
    if(!d) return "";
    if(d.length <= 2) return `0:${d.padStart(2,"0")}`;

    let m = parseInt(d.slice(0,-2),10) || 0;
    let s = parseInt(d.slice(-2),10) || 0;
    m += Math.floor(s/60);
    s = s % 60;
    return `${m}:${String(s).padStart(2,"0")}`;
  }

  function toSecondsMMSS(v){
    if(!v) return 0;
    const f = autoFormatMMSS(v);
    if(!f.includes(":")) return 0;
    const [m,s] = f.split(":");
    return (parseInt(m,10)||0)*60 + (parseInt(s,10)||0);
  }

  function fromSecondsMMSS(sec){
    sec = Math.max(0, sec);
    const m = Math.floor(sec/60);
    const s = sec % 60;
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }

  function updateFilledState(input){
    if(input.value && input.value.trim() !== "") input.classList.add("filled");
    else input.classList.remove("filled");
  }

  // ----------------- HH:MM:SS helpers -----------------
  function pad2(n){ return String(n).padStart(2,"0"); }

  function secondsToHMS(sec){
    sec = ((sec % 86400) + 86400) % 86400;
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = sec % 60;
    return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
  }

function parseHMS(v){
  if(!v) return null;
  v = v.replace(/[^0-9:]/g,"");

  if(!v.includes(":")){
    const d = v.replace(/\D/g,"");
    if(d.length === 6){
      const h = parseInt(d.slice(0,2),10);
      const m = parseInt(d.slice(2,4),10);
      const s = parseInt(d.slice(4,6),10);
      if(m < 60 && s < 60) return h*3600 + m*60 + s;
    }
    if(d.length === 4){
      const h = parseInt(d.slice(0,2),10);
      const m = parseInt(d.slice(2,4),10);
      if(m < 60) return h*3600 + m*60;
    }
    return null;
  }

  const parts = v.split(":");
  const h = parseInt(parts[0]||"0",10) || 0;
  const m = parseInt(parts[1]||"0",10) || 0;
  const s = parseInt(parts[2]||"0",10) || 0;
  if(m >= 60 || s >= 60) return null;
  return h*3600 + m*60 + s;
}


  function nowSec(){
    const n = new Date();
    return n.getHours()*3600 + n.getMinutes()*60 + n.getSeconds();
  }

  function nowPlusSecondsHMS(addSec){
    return secondsToHMS(nowSec() + (addSec || 0));
  }

  // ----------------- UI building -----------------
  function wireAreaInput(input){
    input.addEventListener("focus",()=>setTimeout(()=>input.select(),0));
    input.addEventListener("click",()=>setTimeout(()=>input.select(),0));

    input.addEventListener("keydown",(e)=>{
      if(e.key === "ArrowUp" || e.key === "ArrowLeft"){
        e.preventDefault(); focusPrevVisible(input); return;
      }
      if(e.key === "ArrowDown" || e.key === "ArrowRight"){
        e.preventDefault(); focusNextVisible(input); return;
      }
      if(e.key==="Enter"){
        e.preventDefault();
        input.value = autoFormatMMSS(input.value);
        calculateTotals();
        updateFilledState(input);
        focusNextVisible(input);
      }
    });
    input.addEventListener("input",()=>{
      input.value = sanitizeMMSS(input.value);

      // 3 hane => otomatik format + aÅŸaÄŸÄ± at
      if(!input.value.includes(":")){
        const digits = input.value.replace(/\D/g,"");
        if(digits.length === 3){
          input.value = autoFormatMMSS(digits);
          calculateTotals();
          updateFilledState(input);
          focusNextVisible(input);
          return;
        }
      }

      calculateTotals();
      updateFilledState(input);
    });

    input.addEventListener("blur",()=>{
      if(input.value) input.value = autoFormatMMSS(input.value);
      calculateTotals();
      updateFilledState(input);
    });
  }

  function wireSubInput(input){
    input.addEventListener("focus",()=>setTimeout(()=>input.select(),0));
    input.addEventListener("click",()=>setTimeout(()=>input.select(),0));

    input.addEventListener("input",()=>{
      input.value = sanitizeMMSS(input.value);

      // 4 hane => otomatik format
      if(!input.value.includes(":")){
        const d = input.value.replace(/\D/g,"");
        if(d.length === 4){
          input.value = autoFormatMMSS(d);
        }
      }

      calculateTotals();
      updateFilledState(input);
    });

    input.addEventListener("blur",()=>{
      if(input.value) input.value = autoFormatMMSS(input.value);
      calculateTotals();
      updateFilledState(input);
    });
  }

function formatHMSOnBlur(v){
  if(!v) return "";
  v = v.replace(/[^0-9:]/g,"");

  // NoktasÄ±z giriÅŸ: 193500 / 1935
  if(!v.includes(":")){
    const d = v.replace(/\D/g,"");
    if(d.length === 6) return `${d.slice(0,2)}:${d.slice(2,4)}:${d.slice(4,6)}`;
    if(d.length === 4) return `${d.slice(0,2)}:${d.slice(2,4)}:00`;
    return v;
  }

  // NoktalÄ± giriÅŸ: 19:35 / 19:35:2 / 19:35:20
  const parts = v.split(":");
  if(parts.length === 2){
    // HH:MM -> HH:MM:00
    const h = parts[0].padStart(2,"0").slice(-2);
    const m = parts[1].padStart(2,"0").slice(-2);
    return `${h}:${m}:00`;
  }
  if(parts.length >= 3){
    const h = (parts[0] || "0").padStart(2,"0").slice(-2);
    const m = (parts[1] || "0").padStart(2,"0").slice(-2);
    const sRaw = (parts[2] || "0").replace(/\D/g,"");
    const s = sRaw.padStart(2,"0").slice(-2);
    return `${h}:${m}:${s}`;
  }
  return v;
}

function wireManualInput(input){
  input.addEventListener("focus",()=>setTimeout(()=>input.select(),0));
  input.addEventListener("click",()=>setTimeout(()=>input.select(),0));

  input.addEventListener("input",()=>{
    // sadece izin verilen karakterler (formatlamayÄ± burada ZORLAMAYACAK)
    input.value = input.value.replace(/[^0-9:]/g,"");
    calculateTotals();
  });

  input.addEventListener("blur",()=>{
    // burada dÃ¼zgÃ¼n formata oturt
    input.value = formatHMSOnBlur(input.value);
    calculateTotals();
  });
}

  // ----------------- Focus helpers (Enter + otomatik aÅŸaÄŸÄ± geÃ§iÅŸ) -----------------
  function isVisible(el){ return !!(el && el.offsetParent); }

  function focusPrevVisible(cur){
    const i = allInputs.indexOf(cur);
    for(let j=i-1;j>=0;j--){
      if(isVisible(allInputs[j])){ allInputs[j].focus(); return true; }
    }
    return false;
  }

  function focusNextVisible(cur){
    const i = allInputs.indexOf(cur);
    for(let j=i+1;j<allInputs.length;j++){
      if(isVisible(allInputs[j])){ allInputs[j].focus(); return true; }
    }
    return false;
  }

  function createAreaInputs(containerId, count){
    const c = document.getElementById(containerId);
    for(let i=1;i<=count;i++){
      const row = document.createElement("div");
      row.className = "row";

      const idx = document.createElement("div");
      idx.className = "idx";
      idx.textContent = i + ".";

      const input = document.createElement("input");
      input.className = "time-input";
      input.type = "text";
      input.placeholder = "DK:SN";
      input.inputMode = "numeric";
      input.pattern = "[0-9]*";
      input.autocomplete = "off";
      input.spellcheck = false;

      const clearBtn = document.createElement("button");
      clearBtn.className = "icon-btn";
      clearBtn.type = "button";
      clearBtn.textContent = "âœ•";
      clearBtn.title = "SatÄ±rÄ± temizle";

      wireAreaInput(input);

      clearBtn.addEventListener("click",(e)=>{
        // iOS'ta klavyeyi tekrar aÃ§mamak iÃ§in: input'a focus verme
        e.preventDefault();
        e.stopPropagation();
        if(!input.value) return;
        input.value = "";
        updateFilledState(input);
        calculateTotals();
        // EÄŸer aktif odak bir input ise kapat
        if(document.activeElement && document.activeElement.tagName === "INPUT"){
          document.activeElement.blur();
        }
      });
      row.appendChild(idx);
      row.appendChild(input);
      row.appendChild(clearBtn);
      c.appendChild(row);

      allInputs.push(input);
    }
  }

  function sumArea(id){
    let t=0;
    document.querySelectorAll(`#${id} input`).forEach(i=> t += toSecondsMMSS(i.value));
    return t;
  }

  function hasAnyValue(areaId){
    return Array.from(document.querySelectorAll(`#${areaId} input`))
      .some(i => (i.value || "").trim() !== "");
  }

  // ----------------- Core -----------------
  
  function secondsToMMSS(sec){
    sec = Math.abs(sec|0);
    const m = Math.floor(sec/60);
    const s = sec % 60;
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }

function calculateTotals(){
    const a1 = sumArea("area1"); // seconds
    const a2 = sumArea("area2"); // seconds

    // Total (MM:SS)
    total1.textContent = hasAnyValue("area1") ? fromSecondsMMSS(a1) : "â€”:â€”";
    total2.textContent = hasAnyValue("area2") ? fromSecondsMMSS(a2) : "â€”:â€”";

    // remain (MM:SS) = sub - total
    const rawSub1 = (sub1.value || "").trim();
    if(!rawSub1){
      remain1.textContent = "â€”:â€”";
    }else{
      const s1 = toSecondsMMSS(sub1.value);
      remain1.textContent = fromSecondsMMSS(s1 - a1);
    }

    const rawSub2 = (sub2.value || "").trim();
    if(!rawSub2){
      remain2.textContent = "â€”:â€”";
    }else{
      const s2 = toSecondsMMSS(sub2.value);
      remain2.textContent = fromSecondsMMSS(s2 - a2);
    }

    // haberlerle (HH:MM:SS) = now + total  âœ… her zaman saat bas (total 0 olsa bile)
    commentVal1.textContent = nowPlusSecondsHMS(a1);
    commentVal2.textContent = nowPlusSecondsHMS(a2);

    // Ã§Ä±kar (HH:MM:SS) = manual - (now + total)
    const m1 = parseHMS(manual1.value);
    const box1 = manualVal1.closest(".comment-pill");
    if(m1 == null){
      manualVal1.textContent = "â€”:â€”";
      manualVal1.classList.remove("status-ok","status-bad");
      if(box1) box1.classList.remove("status-ok","status-bad");
    }else{
      const commentSec1 = (nowSec() + a1) % 86400;
      const delta1 = m1 - commentSec1; // manuel - haberlerle
      if(delta1 >= 0){
        manualVal1.textContent = secondsToMMSS(delta1);
        manualVal1.classList.add("status-ok");
        manualVal1.classList.remove("status-bad");
        if(box1){ box1.classList.add("status-ok"); box1.classList.remove("status-bad"); }
      }else{
        // geÃ§ti -> 00:00:00'dan yukarÄ± say (mutlak deÄŸer)
        manualVal1.textContent = secondsToMMSS(delta1);
        manualVal1.classList.add("status-bad");
        manualVal1.classList.remove("status-ok");
        if(box1){ box1.classList.add("status-bad"); box1.classList.remove("status-ok"); }
      }
    }

    const m2 = parseHMS(manual2.value);
    const box2 = manualVal2.closest(".comment-pill");
    if(m2 == null){
      manualVal2.textContent = "â€”:â€”";
      manualVal2.classList.remove("status-ok","status-bad");
      if(box2) box2.classList.remove("status-ok","status-bad");
    }else{
      const commentSec2 = (nowSec() + a2) % 86400;
      const delta2 = m2 - commentSec2; // manuel - haberlerle
      if(delta2 >= 0){
        manualVal2.textContent = secondsToMMSS(delta2);
        manualVal2.classList.add("status-ok");
        manualVal2.classList.remove("status-bad");
        if(box2){ box2.classList.add("status-ok"); box2.classList.remove("status-bad"); }
      }else{
        // geÃ§ti -> 00:00:00'dan yukarÄ± say (mutlak deÄŸer)
        manualVal2.textContent = secondsToMMSS(delta2);
        manualVal2.classList.add("status-bad");
        manualVal2.classList.remove("status-ok");
        if(box2){ box2.classList.add("status-bad"); box2.classList.remove("status-ok"); }
      }
    }
  }

  function clearArea(areaId){
    document.querySelectorAll(`#${areaId} input`).forEach(i=>{
      i.value = "";
      updateFilledState(i);
    });
    calculateTotals();
  }

  
  // ===================== KALICI KAYIT (localStorage) =====================
  const STORAGE_KEY = "sureHesapState_v2";
  let saveTimer = null;

  function collectState(){
    const area1Inputs = Array.from(document.querySelectorAll("#area1 input.time-input"));
    const area2Inputs = Array.from(document.querySelectorAll("#area2 input.time-input"));
    return {
      sub1: sub1.value || "",
      sub2: sub2.value || "",
      manual1: manual1.value || "",
      manual2: manual2.value || "",
      area1: area1Inputs.map(i => i.value || ""),
      area2: area2Inputs.map(i => i.value || ""),
      activeTab: (tab2 && tab2.classList.contains("active")) ? 2 : 1,
    };
  }

  function applyState(state){
    if(!state || typeof state !== "object") return;

    if(typeof state.sub1 === "string") sub1.value = state.sub1;
    if(typeof state.sub2 === "string") sub2.value = state.sub2;
    if(typeof state.manual1 === "string") manual1.value = state.manual1;
    if(typeof state.manual2 === "string") manual2.value = state.manual2;

    const area1Inputs = Array.from(document.querySelectorAll("#area1 input.time-input"));
    const area2Inputs = Array.from(document.querySelectorAll("#area2 input.time-input"));

    if(Array.isArray(state.area1)){
      state.area1.forEach((v, i) => { if(area1Inputs[i]) area1Inputs[i].value = v || ""; });
    }
    if(Array.isArray(state.area2)){
      state.area2.forEach((v, i) => { if(area2Inputs[i]) area2Inputs[i].value = v || ""; });
    }

    // Filled state gÃ¼ncelle
    [...area1Inputs, ...area2Inputs, sub1, sub2, manual1, manual2].forEach(inp => {
      if(inp) updateFilledState(inp);
    });

    // Sekme (mobil)
    if(state.activeTab === 2 && tab2){
      tab2.click();
    }else if(tab1){
      tab1.click();
    }
  }

  function saveStateNow(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(collectState()));
    }catch(e){}
  }

  function scheduleSave(){
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(saveStateNow, 120);
  }

  function loadStateNow(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      applyState(JSON.parse(raw));
    }catch(e){}
  }

  // calculateTotals Ã§aÄŸrÄ±ldÄ±kÃ§a kaydet
  const _calculateTotals = calculateTotals;
  calculateTotals = function(){
    _calculateTotals();
    scheduleSave();
  };

  // Sayfa gizlenince / kapanÄ±nca da kaydet
  window.addEventListener("pagehide", saveStateNow);
  window.addEventListener("beforeunload", saveStateNow);
  document.addEventListener("visibilitychange", ()=> {
    if(document.visibilityState === "hidden") saveStateNow();
  });
  // =======================================================================

// ----------------- Init -----------------
  createAreaInputs("area1", 13);
  createAreaInputs("area2", 7);

  wireSubInput(sub1);
  wireSubInput(sub2);

  wireManualInput(manual1);
  wireManualInput(manual2);

  clearArea1.onclick = ()=> clearArea("area1");
  clearArea2.onclick = ()=> clearArea("area2");

  clearSub1.onclick = ()=>{
    if(!sub1.value) return;
    sub1.value = "";
    updateFilledState(sub1);
    calculateTotals();
    if(document.activeElement && document.activeElement.tagName==="INPUT"){ document.activeElement.blur(); }
  };
  

  // Ä°lk aÃ§Ä±lÄ±ÅŸta son kayÄ±tlarÄ± geri yÃ¼kle
  loadStateNow();
  calculateTotals();
clearSub2.onclick = ()=>{
    if(!sub2.value) return;
    sub2.value = "";
    updateFilledState(sub2);
    calculateTotals();
    if(document.activeElement && document.activeElement.tagName==="INPUT"){ document.activeElement.blur(); }
  };

  function setActiveArea(n){
    document.querySelectorAll(".area").forEach(a=>a.classList.remove("active"));
    document.querySelector(`.area[data-area="${n}"]`).classList.add("active");
    tab1.classList.toggle("active", n===1);
    tab2.classList.toggle("active", n===2);
  }
  tab1.onclick = ()=> setActiveArea(1);
  tab2.onclick = ()=> setActiveArea(2);

  calculateTotals();
  document.querySelectorAll("input").forEach(updateFilledState);

  // âœ… Saat ve tÃ¼revleri canlÄ± kalsÄ±n
  setInterval(calculateTotals, 1000);
</script>

</body>
</html>
